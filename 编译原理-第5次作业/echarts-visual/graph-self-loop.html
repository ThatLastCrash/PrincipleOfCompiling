<!DOCTYPE html>
<!-- saved from url=(0065)https://echarts-try.surge.sh/graph-self-loop/graph-self-loop.html -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="./graph-self-loop_files/echarts.js"></script>
<script src="./graph-self-loop_files/enableGraphEditRoughly.js"></script>
<script src="http://lib.sinaapp.com/js/jquery/1.10.2/jquery-1.10.2.min.js"></script>  
</head>
    <body>
        <style>
            body, html {
                padding: 0;
                margin: 0;
            }
            #main0, #main1,#main2 {
                height: 800px;
            }
            .title {
                background-color: green;
                text-align: center;
                padding: 10px;
                color: #fff;
            }
        </style>
        
        <div class="title">
            é€‰æ‹©ä½ çš„NFAæ•°æ®æ–‡ä»¶ï¼Œå¾€ä¸‹æ»šè½®è¿˜æœ‰DFAå’ŒMFA<br>
            ç»¿è‰²ç‚¹ä»£è¡¨èµ·å§‹çŠ¶æ€ï¼Œçº¢è‰²ç‚¹ä»£è¡¨ç»ˆæ­¢çŠ¶æ€ï¼Œ#ä¸ºç©ºè¾¹<br>
            <input id="inputNFA" type="file">
        </div>
        <div id="main0" _echarts_instance_="ec_1682064421412" style="-webkit-tap-highlight-color: transparent; user-select: none; position: relative;">
			<div style="position: relative; width: 1519px; height: 800px; padding: 0px; margin: 0px; border-width: 0px; cursor: default;">
				<canvas data-zr-dom-id="zr_0" width="1898" height="1000" style="position: absolute; left: 0px; top: 0px; width: 1519px; height: 800px; user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); padding: 0px; margin: 0px; border-width: 0px;">
				</canvas>
			</div>
			<div class="" style="position: absolute; display: block; border-style: solid; white-space: nowrap; z-index: 9999999; box-shadow: rgba(0, 0, 0, 0.2) 1px 2px 10px; transition: opacity 0.2s cubic-bezier(0.23, 1, 0.32, 1) 0s, visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1) 0s, transform 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s; background-color: rgb(255, 255, 255); border-width: 1px; border-radius: 4px; color: rgb(102, 102, 102); font: 14px / 21px &quot;Microsoft YaHei&quot;; padding: 10px; top: 0px; left: 0px; transform: translate3d(495px, 288px, 0px); border-color: rgb(24, 64, 41); pointer-events: none; visibility: hidden; opacity: 0;">
				<div style="margin: 0px 0 0;line-height:1;">
					<span style="font-size:14px;color:#666;font-weight:400;">node_1 &gt; node_1</span>
					<div style="clear:both"></div>
				</div>
			</div>
			<div style="position: absolute; top: 0px; right: 0px; padding: 15px; box-shadow: rgb(0, 0, 0) 0px 2px 5px;">
				<div style="text-align: right;">
				<span style="vertical-align: middle; padding-right: 10px;">symbol size:</span>
				<input type="range" min="0" max="300" step="1" style="vertical-align: middle;">
				<span style="display: inline-block; vertical-align: middle; padding-left: 10px; min-width: 30px;"></span>
				</div>
				<div style="text-align: right;">
					<span style="vertical-align: middle; padding-right: 10px;">self-loop edge count:</span>
					<input type="range" min="0" max="10" step="1" style="vertical-align: middle;">
					<span style="display: inline-block; vertical-align: middle; padding-left: 10px; min-width: 30px;"></span>
				</div>
			</div>
		</div>

        <div class="title">
            é€‰æ‹©ä½ çš„DFAæ•°æ®æ–‡ä»¶ï¼Œå¾€ä¸‹æ»šè½®è¿˜æœ‰MFA<br>
            ç»¿è‰²ç‚¹ä»£è¡¨èµ·å§‹çŠ¶æ€ï¼Œçº¢è‰²ç‚¹ä»£è¡¨ç»ˆæ­¢çŠ¶æ€<br>
            <input id="inputDFA" type="file">
        </div>
        <div id="main1" _echarts_instance_="ec_1682064421412" style="-webkit-tap-highlight-color: transparent; user-select: none; position: relative;">
			<div style="position: relative; width: 1519px; height: 800px; padding: 0px; margin: 0px; border-width: 0px; cursor: default;">
				<canvas data-zr-dom-id="zr_0" width="1898" height="1000" style="position: absolute; left: 0px; top: 0px; width: 1519px; height: 800px; user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); padding: 0px; margin: 0px; border-width: 0px;">
				</canvas>
			</div>
			<div class="" style="position: absolute; display: block; border-style: solid; white-space: nowrap; z-index: 9999999; box-shadow: rgba(0, 0, 0, 0.2) 1px 2px 10px; transition: opacity 0.2s cubic-bezier(0.23, 1, 0.32, 1) 0s, visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1) 0s, transform 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s; background-color: rgb(255, 255, 255); border-width: 1px; border-radius: 4px; color: rgb(102, 102, 102); font: 14px / 21px &quot;Microsoft YaHei&quot;; padding: 10px; top: 0px; left: 0px; transform: translate3d(495px, 288px, 0px); border-color: rgb(24, 64, 41); pointer-events: none; visibility: hidden; opacity: 0;">
				<div style="margin: 0px 0 0;line-height:1;">
					<span style="font-size:14px;color:#666;font-weight:400;">node_1 &gt; node_1</span>
					<div style="clear:both"></div>
				</div>
			</div>
			<div style="position: absolute; top: 0px; right: 0px; padding: 15px; box-shadow: rgb(0, 0, 0) 0px 2px 5px;">
				<div style="text-align: right;">
				<span style="vertical-align: middle; padding-right: 10px;">symbol size:</span>
				<input type="range" min="0" max="300" step="1" style="vertical-align: middle;">
				<span style="display: inline-block; vertical-align: middle; padding-left: 10px; min-width: 30px;"></span>
				</div>
				<div style="text-align: right;">
					<span style="vertical-align: middle; padding-right: 10px;">self-loop edge count:</span>
					<input type="range" min="0" max="10" step="1" style="vertical-align: middle;">
					<span style="display: inline-block; vertical-align: middle; padding-left: 10px; min-width: 30px;"></span>
				</div>
			</div>
		</div>
		
        <div class="title">
            é€‰æ‹©ä½ çš„MFAæ•°æ®æ–‡ä»¶<br>
            ç»¿è‰²ç‚¹ä»£è¡¨èµ·å§‹çŠ¶æ€ï¼Œçº¢è‰²ç‚¹ä»£è¡¨ç»ˆæ­¢çŠ¶æ€<br>
            <input id="inputMFA" type="file">
        </div>
        <div id="main2" _echarts_instance_="ec_1682064421412" style="-webkit-tap-highlight-color: transparent; user-select: none; position: relative;">
			<div style="position: relative; width: 1519px; height: 800px; padding: 0px; margin: 0px; border-width: 0px; cursor: default;">
				<canvas data-zr-dom-id="zr_0" width="1898" height="1000" style="position: absolute; left: 0px; top: 0px; width: 1519px; height: 800px; user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); padding: 0px; margin: 0px; border-width: 0px;">
				</canvas>
			</div>
			<div class="" style="position: absolute; display: block; border-style: solid; white-space: nowrap; z-index: 9999999; box-shadow: rgba(0, 0, 0, 0.2) 1px 2px 10px; transition: opacity 0.2s cubic-bezier(0.23, 1, 0.32, 1) 0s, visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1) 0s, transform 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s; background-color: rgb(255, 255, 255); border-width: 1px; border-radius: 4px; color: rgb(102, 102, 102); font: 14px / 21px &quot;Microsoft YaHei&quot;; padding: 10px; top: 0px; left: 0px; transform: translate3d(495px, 288px, 0px); border-color: rgb(24, 64, 41); pointer-events: none; visibility: hidden; opacity: 0;">
				<div style="margin: 0px 0 0;line-height:1;">
					<span style="font-size:14px;color:#666;font-weight:400;">node_1 &gt; node_1</span>
					<div style="clear:both"></div>
				</div>
			</div>
			<div style="position: absolute; top: 0px; right: 0px; padding: 15px; box-shadow: rgb(0, 0, 0) 0px 2px 5px;">
				<div style="text-align: right;">
				<span style="vertical-align: middle; padding-right: 10px;">symbol size:</span>
				<input type="range" min="0" max="300" step="1" style="vertical-align: middle;">
				<span style="display: inline-block; vertical-align: middle; padding-left: 10px; min-width: 30px;"></span>
				</div>
				<div style="text-align: right;">
					<span style="vertical-align: middle; padding-right: 10px;">self-loop edge count:</span>
					<input type="range" min="0" max="10" step="1" style="vertical-align: middle;">
					<span style="display: inline-block; vertical-align: middle; padding-left: 10px; min-width: 30px;"></span>
				</div>
			</div>
		</div>
		
        <script>
//			const input = document.querySelector('input[type=file]')
			const inputNFA=document.getElementById("inputNFA")
			inputNFA.addEventListener('change', ()=>{
				const reader = new FileReader()
				reader.readAsText(inputNFA.files[0],'utf8') // input.files[0]ä¸ºç¬¬ä¸€ä¸ªæ–‡ä»¶
				reader.onload = ()=>{
				  var data= reader.result  // reader.resultä¸ºè·å–ç»“æœ
				  draw(data,0);
				}
			}, false)
			const inputDFA=document.getElementById("inputDFA")
			inputDFA.addEventListener('change', ()=>{
				const reader = new FileReader()
				reader.readAsText(inputDFA.files[0],'utf8') // input.files[0]ä¸ºç¬¬ä¸€ä¸ªæ–‡ä»¶
				reader.onload = ()=>{
				  var data= reader.result  // reader.resultä¸ºè·å–ç»“æœ
				  draw(data,1);
				}
			}, false)
			const inputMFA=document.getElementById("inputMFA")
			inputMFA.addEventListener('change', ()=>{
				const reader = new FileReader()
				reader.readAsText(inputMFA.files[0],'utf8') // input.files[0]ä¸ºç¬¬ä¸€ä¸ªæ–‡ä»¶
				reader.onload = ()=>{
				  var data= reader.result  // reader.resultä¸ºè·å–ç»“æœ
				  draw(data,2);
				}
			}, false)
            function draw(filedata,index){
				filedata= filedata.split(/[(\r\n)\r\n]+/);
				console.log(filedata);
		        var graph = data2Graph(filedata);
		        drawGraph(graph,index);
    		}
		    function data2Graph(data) {
		        var graph = {}
		        var vertices = {}
		        var links = [];
		        var nodes = [];
		        var randlist=[300,400,500,600,700,800];
		        var color=['red','blue','green'];
		        var state_num=0;
		        
				var arr = new Array();         //ÏÈÉùÃ÷Ò»Î¬
		       for(var i=0;i<100;i++){          //Ò»Î¬³¤¶ÈÎª5
		          arr[i]=new Array(i);    //ÔÚÉùÃ÷¶şÎ¬
		          for(var j=0;j<100;j++)      //¶şÎ¬³¤¶ÈÎª5
		             arr[i][j]=i;
		       }

		        for(var i=0;i<data.length;i++)
		        {
		        	if(i==0)
		        	{
		        		state_num=eval(data[i]);
		        		for(var j=0;j<=state_num;j++)
		        		{
		        			var str=data[j+1].split(",");
		        			var rnd1=parseInt(Math.random()*10%6);
		        			var rnd2=parseInt(Math.random()*10%6);
							var c=color[eval(str[1])+1];
		        			nodes.push({'name' : str[0], 
//										'x' : randlist[rnd1],
//										'y'	: randlist[rnd2],
										'itemStyle':{
							                  normal:{color:c}
							              }
										});
		        		}
		        		i=i+state_num+1;
		        		continue;
		        	}
		        	if(data[i]=="")continue;
		        	var str=data[i].split(",");
		        	var x=parseInt(str[0]);
		        	var y=parseInt(str[1]);
		        	var rnd3=parseInt(Math.random()*10%3);
		        	if(str[0]==str[1]) rnd3=0.1;
		        	if(arr[x][y]==rnd3) rnd3=rnd3+0.3;
					console.log(rnd3,arr[x][y],x,y)
		        	arr[str[0]][str[1]]=rnd3;arr[str[1]][str[0]]=rnd3;
		        	links.push({'id':str[2],
								'source':str[0],
								'target':str[1],
								'label':{
									show:true
								},
								'lineStyle':{
									curveness : rnd3
								}
								});
		    	}
		        graph['links'] = links;
		        graph['data'] = nodes;
		        return graph;
		    }
		    function drawGraph(graph,index) {
		    	console.log(graph);
	            var option = {
	                tooltip: {},
	                animationDurationUpdate: 1500,
	                animationEasingUpdate: 'quinticInOut',
	                series : [
	                    {
	                        type: 'graph',
	                        id: 'grh',
	                        symbolSize: 100,
	                        roam: 'scale',
	                        layout: 'force',
		                    force: {
		                        repulsion: 2000,
		                        edgeLength: 500
		                    },
	                        // draggable : true,1
	                        // selectedMode: true,
	                        label: {
	                            normal: {
	                                show: true,
	                                color:'white',
	                                fontSize:20
	                            }
	                        },
	                        edgeSymbol: ['circle', 'arrow'],
	                        edgeSymbolSize: [4, 10],
	                        edgeLabel: {
	                            textStyle: {
	                                color: 'red',
	                                fontSize: 12
	                            },
	                            emphasis: {
	                                textStyle: {
	                                    color: '#987654'
	                                }
	                            },
		                        normal: {
		                            show: true,
		                            position: 'middle',
		                            color:'red',
		                            fontSize:20
		                        }
	                        },
	                        // focusNodeAdjacency: focusNodeAdjacency,
	                        lineStyle: {
	                            width: 3,
	                            color: '#184029',
	                            curveness: 0
	                        },
	                        itemStyle: {
	                            opacity: 0.7
	                        },
	                        emphasis: {
	                            focus: 'adjacency'
	                        },
		                    force: {
		                        repulsion: 1000,
		                        edgeLength: 200
		                    },
	                        data: graph.data,
	                        links: graph.links,
	                        autoCurveness: true
	                    }
	                ]
	            };
	            var dom = document.getElementById('main0');
	            if (dom && index==0) {
	                var chart = echarts.init(dom);
	                chart.setOption(option);
	
	                enableGraphEditRoughly({
	                    chart: chart,
	                    option: option,
	                    seriesId: 'grh',
	                    drag: true,
	                    editNodeSize: true,
	                    editSelfLoopEdgeCount: true,
	                    selfLoopEdgeNodeName: 'node_1'
	                });
	            }
	            var dom1 = document.getElementById('main1');
	            if (dom1 && index==1) {
	                var chart = echarts.init(dom1);
	                chart.setOption(option);
	
	                enableGraphEditRoughly({
	                    chart: chart,
	                    option: option,
	                    seriesId: 'grh',
	                    drag: true,
	                    editNodeSize: true,
	                    editSelfLoopEdgeCount: true,
	                    selfLoopEdgeNodeName: 'node_2'
	                });
	            }
	            var dom2 = document.getElementById('main2');
	            if (dom2 && index==2) {
	                var chart = echarts.init(dom2);
	                chart.setOption(option);
	
	                enableGraphEditRoughly({
	                    chart: chart,
	                    option: option,
	                    seriesId: 'grh',
	                    drag: true,
	                    editNodeSize: true,
	                    editSelfLoopEdgeCount: true,
	                    selfLoopEdgeNodeName: 'node_3'
	                });
	            }
		    }
        </script>

</body></html>
